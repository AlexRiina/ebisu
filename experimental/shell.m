data = [ 1.321e+0,3.774e+0,4.527e+2
 1.304e+0,4.072e+0,4.400e+2
 1.211e+0,3.958e+0,4.686e+2
 9.117e-1,3.917e+0,3.978e+2
 1.755e+0,3.748e+0,1.884e+2
 1.205e+0,3.784e+0,2.519e+2
 1.067e+0,3.976e+0,3.188e+2
 1.019e+0,4.573e+0,2.282e+2
 1.103e+0,3.833e+0,2.875e+2
 1.244e+0,3.993e+0,2.984e+2
 1.315e+0,3.996e+0,4.400e+2
 1.307e+0,3.994e+0,4.439e+2
 1.336e+0,5.135e+0,3.882e+2
 4.896e+0,3.402e+0,3.843e+1
 7.305e-1,4.708e+0,3.636e+2
 1.290e+0,4.418e+0,1.537e+2
 1.314e+0,3.924e+0,2.166e+2
 1.286e+0,4.187e+0,4.440e+2
 1.565e+0,4.104e+0,3.818e+2
 1.913e+0,2.152e+1,2.223e+2
 1.566e+0,4.960e+0,1.314e+2
 1.147e+0,3.923e+0,1.444e+2
 1.483e+0,4.883e+0,3.731e+2
 1.706e+0,1.929e+1,2.223e+2
 1.216e+0,5.227e+0,1.224e+2
 1.052e+0,4.823e+0,1.105e+2
 1.803e+0,3.421e+0,6.596e+1
 1.444e+0,5.026e+0,3.752e+2
 1.376e+0,4.819e+0,3.817e+2
 1.319e+0,5.001e+0,3.960e+2
 1.359e+0,4.943e+0,3.881e+2
 1.323e+0,4.484e+0,1.886e+2
 7.970e-1,4.827e+0,3.133e+2
 1.752e+0,3.321e+0,8.409e+1
 1.324e+0,4.488e+0,1.882e+2
 9.483e-1,5.131e+0,3.187e+2
 7.875e-1,4.647e+0,3.137e+2
 1.077e+0,4.830e+0,4.681e+2
 1.181e+0,4.740e+0,4.440e+2
 1.428e+0,4.914e+0,3.828e+2
 2.534e+0,1.724e+1,3.188e+2
 1.463e+0,4.762e+0,3.762e+2
 1.438e+0,4.876e+0,3.819e+2
 3.423e+0,1.097e+1,2.033e+2
 1.395e+0,4.732e+0,3.877e+2
 2.330e+0,9.390e+0,2.994e+2
 1.365e+0,4.754e+0,2.499e+2
 1.409e+0,3.922e+0,2.519e+2
 1.461e+0,4.668e+0,3.819e+2
 1.202e+0,4.842e+0,4.289e+2
 1.209e+0,4.684e+0,2.507e+2
 8.798e-1,5.102e+0,3.345e+2
 2.231e+0,2.015e+1,3.185e+2
 1.191e+0,4.071e+0,4.539e+2
 1.299e+0,3.922e+0,2.054e+2
 1.477e+0,5.625e+0,1.649e+2
 7.196e-1,5.996e+0,2.916e+2
 4.175e+0,4.511e+0,3.838e+1
 2.041e+0,1.396e+1,1.683e+2
 4.224e+0,8.279e+0,6.599e+1
 1.381e+0,4.105e+0,1.794e+2
 1.197e+0,8.308e+0,3.185e+2
 1.901e+0,4.404e+0,1.192e+2
 1.763e+0,1.267e+1,3.186e+2
 1.595e+0,8.493e+0,5.069e+2
 3.415e+0,1.175e+1,2.031e+2
 4.424e+0,3.718e+0,3.840e+1
 7.598e-1,4.000e+0,2.503e+2
 1.315e+0,4.844e+0,1.811e+2
 1.155e+0,4.693e+0,1.791e+2
 1.269e+0,4.188e+0,4.055e+2
 3.100e+0,5.216e+0,2.513e+2
 1.136e+0,4.105e+0,4.439e+2
 4.410e+0,3.510e+0,3.836e+1
 6.182e-1,8.064e+0,2.032e+2
 1.020e+0,5.101e+0,1.223e+2
 1.169e+0,5.324e+0,2.222e+2
 1.887e+0,3.715e+0,9.635e+1
 1.138e+0,4.294e+0,4.686e+2
 2.367e+0,3.520e+0,9.424e+1
 1.259e+0,7.325e+0,3.185e+2
 8.791e-1,4.820e+0,2.284e+2
 2.998e+0,1.527e+0,4.791e+1
 9.629e-1,4.837e+0,1.818e+2
 1.713e+0,8.869e+0,1.880e+2
 1.429e+0,4.768e+0,1.858e+2
 8.726e-1,4.884e+0,2.502e+2
 1.215e+0,5.001e+0,3.812e+2
 1.376e+0,3.720e+0,4.053e+2
 1.370e+0,3.999e+0,3.970e+2
 1.414e+0,4.084e+0,4.801e+2
 1.356e+0,4.134e+0,3.971e+2
 1.391e+0,4.005e+0,3.904e+2
 1.496e+0,1.654e+0,5.855e+2
 1.296e+0,1.594e+0,2.986e+2
 1.282e+0,3.975e+0,2.868e+2
 1.232e+0,3.769e+0,4.054e+2
 1.246e+0,4.299e+0,3.801e+2
 1.442e+0,3.605e+0,3.939e+2
 1.346e+0,4.739e+0,3.725e+2
 1.117e+0,3.842e+0,4.686e+2
 1.406e+0,4.450e+0,3.730e+2
 1.264e+0,4.488e+0,3.926e+2
 1.210e+0,4.560e+0,3.806e+2
 7.102e-1,6.702e+0,2.882e+2
 1.149e+0,3.788e+0,1.571e+2
 1.057e+0,6.776e+0,2.165e+2
 1.414e+0,3.956e+0,1.883e+2
 8.412e-1,4.628e+0,3.883e+2
 1.244e+0,4.202e+0,3.810e+2
 1.227e+0,3.897e+0,4.055e+2
 1.382e+0,3.726e+0,3.987e+2
 1.255e+0,1.069e+0,7.651e+2
 1.207e+0,3.887e+0,4.056e+2
 2.799e+0,1.315e+0,7.337e+1
 2.405e+0,3.855e+0,2.516e+2
 1.144e+0,6.846e+0,2.165e+2
 7.602e-1,5.421e+0,2.916e+2
 1.178e+0,4.116e+0,1.537e+2
 1.269e+0,3.639e+0,4.053e+2
 1.624e+0,4.588e+0,9.341e+1
 6.660e-1,4.602e+0,2.987e+2
 1.138e+0,4.698e+0,1.812e+2
 1.346e+0,4.585e+0,1.099e+2
 1.409e+0,3.728e+0,3.904e+2
 1.446e+0,4.592e+0,1.812e+2
 8.850e-1,4.818e+0,2.509e+2
 1.746e+0,3.725e+0,8.276e+1
 1.291e+0,5.231e+0,3.536e+2
 1.279e+0,6.076e+0,2.635e+2
 9.645e-1,4.933e+0,2.779e+2
 1.458e+0,5.987e+0,1.791e+2
 1.411e+0,4.657e+0,1.888e+2
 8.090e-1,4.340e+0,3.877e+2
 3.527e+0,6.406e+0,2.034e+2
 1.366e+0,4.815e+0,3.343e+2
 1.222e+0,4.445e+0,3.965e+2
 1.041e+0,4.950e+0,2.034e+2
 1.187e+0,4.667e+0,1.683e+2
 7.228e-1,4.111e+0,3.452e+2
 2.197e+0,3.499e+0,4.419e+1
 7.822e-1,4.964e+0,1.537e+2
 1.603e+0,5.580e+1,2.223e+2
 9.494e-1,4.235e+0,1.102e+2
 1.200e+0,4.762e+0,3.817e+2
 1.424e+0,4.816e+0,2.280e+2
 1.093e+0,4.487e+0,2.284e+2
 1.262e+0,4.544e+0,3.883e+2
 1.392e+0,4.665e+0,3.254e+2
 1.208e+0,4.808e+0,3.817e+2
 1.261e+0,4.395e+0,3.882e+2
 7.122e-1,5.024e+0,3.137e+2
 1.397e+0,9.738e+0,3.188e+2
 9.677e-1,5.280e+0,2.277e+2
 8.484e-1,4.204e+0,2.504e+2
 1.249e+0,4.825e+0,2.046e+2
 9.486e-1,5.336e+0,1.813e+2
 8.716e-1,4.991e+0,1.105e+2
 5.579e-1,7.924e+0,2.032e+2
 1.183e+0,6.047e+0,9.412e+1
 1.392e+0,6.560e+0,9.399e+1
 9.528e-1,5.358e+0,1.791e+2
 1.788e+0,4.510e+0,7.291e+1
 1.074e+0,6.013e+0,1.686e+2
 7.009e-1,4.653e+0,2.498e+2
 7.817e-1,4.755e+0,3.967e+2
 1.338e+0,4.292e+0,1.886e+2
 1.429e+0,3.858e+0,4.802e+2
 1.017e+0,5.609e+0,3.186e+2
 7.533e-1,4.635e+0,2.970e+2
 1.167e+0,4.744e+0,1.573e+2
 1.530e+0,3.412e+0,3.730e+2
 3.006e+0,4.938e+0,2.514e+2
 1.661e+0,5.303e+0,1.314e+2
 6.627e-1,8.280e+0,2.769e+2
 1.052e+0,4.908e+0,1.683e+2
 1.241e+0,4.067e+0,3.808e+2
 7.868e-1,5.501e+0,2.773e+2
 9.693e-1,4.843e+0,2.028e+2
 1.362e+0,4.640e+0,1.813e+2
 1.071e+0,3.944e+0,3.967e+2
 3.693e+0,1.089e+1,9.621e+1
 6.819e-1,5.806e+0,2.034e+2
 1.036e+0,3.776e+0,1.065e+2
 8.182e-1,3.719e+0,1.088e+2
 1.319e+0,6.925e+0,9.646e+1
 3.731e-1,1.473e+1,2.031e+2
 8.163e-1,1.398e+1,2.222e+2
 1.036e+0,4.079e+0,2.054e+2
 5.568e-1,3.558e+0,1.813e+2
 1.124e+0,4.751e+0,1.621e+2
 2.098e+0,4.854e+0,7.219e+1
 1.117e+0,5.160e+0,2.223e+2
 1.125e+0,5.671e+0,1.202e+2
 6.608e-1,5.155e+0,2.034e+2
 7.360e-1,4.483e+0,1.648e+2
 1.261e+0,6.132e+0,3.537e+2
 6.883e-1,5.523e+0,2.987e+2
 4.751e-1,1.059e+1,2.032e+2
 1.032e+0,5.018e+0,1.314e+2
 1.633e+0,4.458e+0,8.526e+1
 7.713e-1,1.508e+1,1.537e+2
 3.129e+0,6.169e+0,1.884e+2
 7.883e-1,5.221e+0,2.034e+2
 1.295e+0,4.320e+0,2.162e+2
 1.196e+0,5.405e+0,1.532e+2
 9.262e-1,4.130e+0,2.503e+2
 1.291e+0,4.205e+0,2.167e+2
 1.340e+0,7.569e+0,2.745e+2
 6.940e-1,6.427e+0,2.498e+2
 9.496e-1,4.817e+0,1.106e+2
 6.076e-1,5.247e+0,2.033e+2
 1.101e+0,9.694e+0,1.814e+2
 1.159e+0,3.806e+0,3.350e+2
 1.038e+0,5.883e+0,2.986e+2
 1.070e+0,3.064e+0,2.516e+2
 7.940e-1,4.633e+0,3.007e+2
 1.096e+0,5.779e+0,2.222e+2
 1.885e+0,5.010e+0,9.629e+1
 5.993e-1,9.851e+0,2.032e+2
 8.516e-1,4.645e+0,1.224e+2
 1.686e+0,9.427e+0,2.743e+2
 1.155e+0,2.971e+0,1.587e+2
 1.218e+0,4.350e+0,2.274e+2
 8.782e-1,4.310e+0,2.507e+2
 2.436e+0,5.070e+0,2.514e+2
 1.954e+0,5.168e+0,2.987e+2
 1.375e+0,4.222e+0,1.794e+2
 7.438e-1,1.124e+1,2.497e+2
 1.086e+0,4.256e+0,6.311e+1
 7.996e-1,4.201e+0,2.223e+2
 5.550e-1,5.347e+0,2.032e+2
 1.138e+0,3.672e+0,6.572e+1
 1.254e+0,5.384e+0,9.651e+1
 7.939e-1,6.648e+0,1.223e+2
 1.709e+0,9.643e+0,1.881e+2
 1.377e+0,4.753e+0,1.817e+2
 1.138e+0,1.562e+1,2.224e+2
 9.216e-1,5.423e+0,1.228e+2
 8.451e-1,5.332e+0,1.102e+2
 1.332e+0,3.994e+0,2.881e+2
 1.212e+0,5.016e+0,1.314e+2
 9.536e-1,6.456e+0,2.223e+2
 5.511e-1,7.394e+0,1.816e+2
 8.884e-1,5.412e+0,1.096e+2
 1.179e+0,3.992e+0,3.132e+2
 9.720e-1,4.885e+0,9.641e+1
 7.871e-1,4.410e+0,2.224e+2
 1.036e+0,7.159e+0,9.404e+1
 5.272e-1,5.904e+0,2.032e+2
 9.666e-1,5.144e+0,9.394e+1
 1.494e+0,5.148e+0,1.376e+2
 1.448e+0,1.430e+1,1.810e+2
 1.116e+0,4.170e+0,1.224e+2
 1.077e+0,8.032e+0,9.652e+1
 1.340e+0,4.979e+0,9.400e+1
 5.800e-1,1.766e+1,2.032e+2
 1.508e+0,4.582e+0,2.986e+2
 8.069e-1,4.457e+0,3.138e+2
 1.897e+0,4.189e+0,2.520e+2
 4.651e-1,4.152e+0,4.330e+2
 2.658e+0,3.976e+0,1.923e+2
 1.881e+0,4.321e+0,2.521e+2
 1.879e+0,4.612e+0,2.519e+2
 1.480e+0,4.776e+0,2.986e+2
 1.695e+0,5.518e+0,2.523e+2
 1.633e+0,8.837e+0,3.537e+2
 2.190e+0,7.751e+0,1.794e+2
 1.635e+0,9.565e+0,2.222e+2
 1.683e+0,5.010e+0,2.510e+2
 2.215e+0,4.699e+0,2.031e+2
 1.680e+0,5.039e+0,2.511e+2
 1.558e+0,1.355e+1,3.187e+2
 1.679e+0,5.037e+0,2.511e+2
 1.298e+0,4.308e+0,1.905e+2
 8.090e-1,4.924e+0,2.283e+2
 2.209e+0,7.775e+0,1.795e+2
 1.648e+0,5.418e+0,2.514e+2
 1.519e+0,7.787e+0,2.520e+2
 2.199e+0,4.840e+0,2.033e+2
 2.161e+0,5.249e+0,2.034e+2
 1.262e+0,6.459e+0,2.984e+2
 1.364e+0,6.443e+0,4.128e+2
 2.160e+0,1.189e+1,1.811e+2
 1.572e+0,1.203e+1,3.189e+2
 1.346e+0,4.932e+0,2.749e+2
 1.601e+0,8.591e+0,1.374e+2
 1.490e+0,6.149e+0,2.223e+2
 2.061e+0,3.330e+1,1.376e+2
 1.329e+0,6.109e+0,1.812e+2
 1.097e+0,2.125e+1,2.223e+2
 1.417e+0,4.438e+0,8.527e+1
 9.359e-1,5.676e+0,1.312e+2
 1.384e+0,5.724e+0,1.811e+2
 1.337e+0,5.943e+0,1.811e+2
 1.123e+0,5.176e+0,2.048e+2
 1.336e+0,3.699e+0,7.204e+1
 9.158e-1,5.324e+0,9.653e+1
 8.950e-1,4.939e+0,1.502e+2
 1.373e+0,4.931e+0,1.812e+2
];
a = data(:,1); % Ebisu alpha
b = data(:, 2); % Ebisu beta
c = gammaln(a + b) - gammaln(a); % fixed delta-independent portion of predictRecall

d = logspace(-1, 1, 6); % delta, vector: if < 1, reviewing early, else reviewing late
d = 1.1; % delta, scalar

expected = gammaln(a + d) - gammaln(a + b + d); % WITHOUT c
[l, h] = bnd(a + d, a + b + d); % WITHOUT c

assert(all(log(l) < expected));
assert(all(log(h) > expected));
assert(all(log(l) + c < c + expected));
assert(all(log(h) + c > c + expected));

% option 1: sort using just lower bound
actual = log(l);
var(compareSorted(expected, actual))
var(compareSorted(expected + c, actual + c))

% option 2: sort using mean of logs of lower and upper bound
actual2 = (log(l) + log(h)) / 2;
var(compareSorted(expected, actual2))
var(compareSorted(expected + c, actual2 + c))

% Yabai. Only the first comparison works well. The rest have relatively crappy sort performance.

n = 1 : size(data, 1);

figure;
subplot(211)
plot(n, compareSorted(expected, actual), n, compareSorted(expected + c, actual + c))
title('actual (sort order)')
subplot(212)
plot(n, compareSorted(expected, actual2), n, compareSorted(expected + c, actual2 + c))
title('actual2 (sort order)')

figure;
subplot(211)
errorbar(n, expected, log(l), log(h))
title('withOUT c')
subplot(212)
errorbar(n, expected + c, log(l) + c, log(h) + c)
title('with c')

figure;plot(n, expected + c, 'o-', n, actual2 + c, 'x-')
legend('expected + c', 'actual2 + c')

% But the values are pretty close... we could use actual or actual2 for predictRecallApprox. In Matlab though, `bnd` is 4.5x slower than two `gammaln`.

